/*! wee-promise - 1.0.1 - Bernard McManus - 06840c4 - 2015-12-14 */
!function(a){"use strict";function b(){var a=this;a.q=[],a.i=0,a.len=0}function c(a){var c=this,f=h(function(a,b){a(c,b)});if(c._state=k,c._stack=new b,c.resolve=function(a){return f(d,a),c},c.reject=function(a){return f(e,a),c},a)try{a(c.resolve,c.reject)}catch(g){c.reject(g)}}function d(a,b){b===a?e(a,new TypeError("A promise cannot be resolved with itself.")):g(b,function(b,c){f(a,b,c)})}function e(a,b){f(a,m,b)}function f(a,b,c){a._state!=b&&(a._value=c,a._state=b,a._flush())}function g(b,d){if(b instanceof c&&b._state)d(b._state,b._value);else if(i(b)||j(b)){var e,f=h(function(b,c){b.apply(a,c)});try{e=b.then,j(e)?e.call(b,function(a){f(g,[a,d])},function(a){f(d,[m,a])}):f(d,[l,b])}catch(k){f(d,[m,k])}}else d(l,b)}function h(b){var c;return function(){c||(b.apply(a,arguments),c=!0)}}function i(a){return a&&"object"==typeof a}function j(a){return"function"==typeof a}b.prototype.put=function(a){var b=this;b.q[b.len]=a,b.len++},b.prototype.get=function(){var a=this,b=a.q[a.i];return a.i++,a.i==a.len&&(a.q.length=a.i=a.len=0),b};var k=0,l=1,m=2;c.prototype={constructor:c,onresolved:function(a){return a},onrejected:function(a){throw a},_flush:function(){var a=this,b=a._state;b&&c.async(function(){!function c(){var f=a._stack.get();if(f){var g=b==l?f.onresolved:f.onrejected;try{d(f,g(a._value))}catch(h){e(f,h)}c()}}()})},then:function(a,b){var d=this,e=new c;return j(a)&&(e.onresolved=a),j(b)&&(e.onrejected=b),d._stack.put(e),d._flush(),e},"catch":function(b){return this.then(a,b)}},c.resolve=function(a){return(new c).resolve(a)},c.reject=function(a){return(new c).reject(a)},c.all=function(a){var b=new c,d=[],e=0,f=a.length;return a.forEach(function(a,c){g(a,function(a,g){e++,d[c]=g,a==m?b.reject(g):e==f&&b.resolve(d)})}),b},c.race=function(a){var b=new c;return a.forEach(function(a){g(a,function(a,c){f(b,a,c)})}),b},c.async=function(){var b=""+a;return typeof setImmediate!=b?setImmediate:typeof MessageChannel!=b?function(a){var b=new MessageChannel;b.port1.onmessage=function(){a()},b.port2.postMessage(0)}:function(a){setTimeout(a)}}(),"object"==typeof exports?module.exports=c:self.WeePromise=c}();