/*! wee-promise - 1.1.0 - Bernard McManus - 09e692a - 2017-07-06 */
(function(){"use strict";function t(t){var o=this,r=i(function(t,e){t(o,e)});if(this._state=p,this._stack=f(),this.resolve=function(t){return r(e,t),o},this.reject=function(t){return r(n,t),o},t)try{t(this.resolve,this.reject)}catch(t){this.reject(t)}}function e(t,e){e===t?n(t,new TypeError("A promise cannot be resolved with itself.")):r(e,function(e,n){o(t,e,n)})}function n(t,e){o(t,y,e)}function o(t,e,n){t._state!=e&&(t._value=n,t._state=e,t._flush())}function r(e,n){if(e instanceof t&&e._state)n(e._state,e._value);else if(c(e)||u(e)){var o=i(function(t,e){t.apply(void 0,e)});try{var s=e.then;u(s)?s.call(e,function(t){o(r,[t,n])},function(t){o(n,[y,t])}):o(n,[d,e])}catch(t){o(n,[y,t])}}else n(d,e)}function i(t){var e=void 0;return function(){e||(t.apply(void 0,arguments),e=!0)}}function c(t){return t&&"object"==typeof t}function u(t){return"function"==typeof t}var s=this,f=function(){var t=[],e=0,n=0;return{put:function(e){t[n]=e,n++},get:function(){var o=t[e];return++e>=n&&(t.length=e=n=0),o}}},a=void 0;if(s.setImmediate)a=setImmediate;else if(s.MessageChannel){var v=f(),h=new MessageChannel;h.port1.onmessage=function(){for(var t=void 0;t=v.get();)t()},a=function(t){v.put(t),h.port2.postMessage(0)}}else a=setTimeout;var l=a,p=0,d=1,y=2,_=t;t.async=function(t){l(t)},t.prototype.onresolved=function(t){return t},t.prototype.onrejected=function(t){throw t},t.prototype._flush=function(){var o=this,r=this._state,i=this._stack;if(r){var c=function(){var t=i.get();if(t){var u=r===d?t.onresolved:t.onrejected;try{e(t,u(o._value))}catch(e){n(t,e)}c()}};t.async(c)}},t.prototype.then=function(e,n){var o=new t;return u(e)&&(o.onresolved=e),u(n)&&(o.onrejected=n),this._stack.put(o),this._flush(),o},t.prototype.catch=function(t){return this.then(void 0,t)},t.resolve=function(e){return(new t).resolve(e)},t.reject=function(e){return(new t).reject(e)},t.all=function(e){var n=new t,o=[],i=e.length,c=0;return e.forEach(function(t,e){r(t,function(t,r){c++,o[e]=r,t===y?n.reject(r):c===i&&n.resolve(o)})}),n},t.race=function(e){var n=new t;return e.forEach(function(t){r(t,function(t,e){o(n,t,e)})}),n},"object"==typeof exports?module.exports=_:s.WeePromise=_}).call(this);