/*! wee-promise - 0.2.0 - Bernard McManus - g3ba1fa - 2014-11-29 */
!function(a){var b=this;"object"==typeof exports?module.exports=a:(b.WeePromise=a,b.Promise=b.Promise||a)}(function(a){function b(a){var b=this;k([v,w,u],function(a){b[a]=[]}),h(function(){b[B]=e(b),i(b,function(){a(c(b,v),c(b,w))}),b[z]=!0})}function c(a,b){function c(d){h(a[z]?function(){a[o]||a[y](b,d)[y](u,d)}:function(){c(d)})}return c}function d(a,b,c,d,e){return function(){a=a.map(function(a){return g(a[p])?a[p]:a});var h=f(a,1),i=f(a,-1);if(j(h)===d){var k=h.map(function(a){return a[p][0]});b(e?k[0]:k)}else j(i)>0&&c(i[0][p][0])}}function e(a){return j(a[w])>0}function f(a,b){return a.filter(function(a){return a[o]===b})}function g(a){return a instanceof b}function h(b){a(b,1)}function i(a,b){try{return b()}catch(c){return a[y](w,c)}}function j(a){return a.length}function k(a,b){a.forEach(b)}var l,m="__",n="prototype",o="state",p="args",q="always",r="then",s="catch",t=m+"pass",u=m+q,v=m+r,w=m+s,x=m+"add",y=m+"exec",z=m+"ready",A=m+"child",B=m+"caught",C=B+"Self",D={};return D[v]=1,D[w]=-1,b[n][x]=function(a,b){var c=this;return b&&c[a].push(b),c},b[n][y]=function(a,b){var c,d=this,e=d[a],f=j(e),h=0;return i(d,function(){for(;f>h&&(!D[a]||d[o]!==D[a]||d[C]);){if(c=(D[a]?e.shift():e[h]).apply(l,[b]),b=D[a]?c:b,g(c))return d[t](c,a);if(a===w){if(d[B]&&d[A])return d[o]=D[v],d[p]=[c],d[y](v,c);break}h++}return d[p]=d[o]?d[p]:[b],d[o]=D[a]||d[o],a===w&&d[B]&&(d[o]=D[v]),d})},b[n][q]=function(a){return this[x](u,a)},b[n][r]=function(a,b){return this[x](v,a)[s](b)},b[n][s]=function(a){return this[x](w,a)},b[n][t]=function(a,b){var c=this;return a[C]=e(a),a[A]=!0,k([v,w,u],function(d){a[d]=d!=b?a[d].concat(c[d]):c[d]}),c[p]=a,a},b.all=function(a){return new b(function(b,c){k(a,function(e){e[q](d(a,b,c,j(a)))})})},b.race=function(a){return new b(function(b,c){k(a,function(e){e[q](d(a,b,c,1,!0))})})},b}(setTimeout));